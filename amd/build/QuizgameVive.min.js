define(["jquery","mod_quizgame/Quizgame"],function(a,b){var c=Math.PI/180;QuizgameVive=function(a){b.call(this,a),this.controller1,this.controller2,this.eyeview={width:1024,height:256}},QuizgameVive.prototype=Object.create(b.prototype),QuizgameVive.prototype.constructor=QuizgameVive,QuizgameVive.prototype.render=function(){this.controller1.update(),this.controller2.update(),this.renderer.render(this.scene,this.camera)},QuizgameVive.prototype.handleLaser=function(a){},QuizgameVive.prototype.initGame=function(){b.prototype.initGame.call(this),this.renderer.vr.enabled=!0,this.renderer.vr.standing=!0;var a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0)),a.vertices.push(new THREE.Vector3(0,0,(-1)));var c=new THREE.LineBasicMaterial({color:16351250}),d=new THREE.Line(a,c);d.name="line",d.scale.z=20,this.controller1=new THREE.ViveController(0),this.controller1.standingMatrix=this.renderer.vr.getStandingMatrix(),this.controller1.addEventListener("triggerdown",this.handleViveTrigger1.bind(this)),this.controller1.add(d.clone()),this.scene.add(this.controller1),this.controller2=new THREE.ViveController(1),this.controller2.standingMatrix=this.renderer.vr.getStandingMatrix(),this.controller2.addEventListener("triggerdown",this.handleViveTrigger2.bind(this)),this.controller2.add(d.clone()),this.scene.add(this.controller2);var e=new THREE.OBJLoader;e.setPath("models/obj/vive-controller/"),e.load("vr_controller_vive_1_5.obj",function(a){var b=new THREE.TextureLoader;b.setPath("models/obj/vive-controller/");var c=a.children[0];c.material.map=b.load("onepointfive_texture.png"),c.material.specularMap=b.load("onepointfive_spec.png"),this.controller1.add(a.clone()),this.controller2.add(a.clone()),this.controller2.add(this.hudPlane)}.bind(this)),WEBVR.getVRDisplay(function(a){this.renderer.vr.setDevice(a),document.body.appendChild(WEBVR.getButton(a,this.renderer.domElement))}.bind(this)),WEBVR.checkAvailability()["catch"](function(a){document.body.appendChild(WEBVR.getMessageContainer(a))})},QuizgameVive.prototype.createHUD=function(){this.hudCanvas=document.createElement("canvas"),this.hudCanvas.width=this.eyeview.width,this.hudCanvas.height=this.eyeview.height,this.hudTexture=new THREE.Texture(this.hudCanvas),this.updateHUD();var a=new THREE.MeshBasicMaterial({map:this.hudTexture});a.transparent=!0;var b=new THREE.PlaneGeometry(this.eyeview.width/2e3,this.eyeview.height/2e3);this.hudPlane=new THREE.Mesh(b,a),this.hudPlane.translateZ(-0),this.hudPlane.translateY(.1),this.hudPlane.rotateX(-45*c)},QuizgameVive.prototype.updateHUD=function(){var a=Math.round(50);this.eyeview={width:1024,height:256},this.hudCanvas.width=this.eyeview.width,this.hudCanvas.height=this.eyeview.height,this.hudBitmap=this.hudCanvas.getContext("2d"),this.hudBitmap.clearRect(0,0,this.eyeview.width,this.eyeview.height),this.hudBitmap.font=a+"px Arial",this.hudBitmap.textAlign="center",this.hudBitmap.fillStyle="#f98012";var b=Math.min(this.level,this.questions.length-1);this.wrapText(this.hudBitmap,this.questions[b].question,this.eyeview.width/2,.25*this.eyeview.height,.66*this.eyeview.width,a),this.hudBitmap.font=a+"px Arial",this.hudBitmap.textAlign="center",this.hudBitmap.fillStyle="#f98012",this.hudBitmap.fillText("Score: "+Math.round(this.score)+" Level: "+(this.level+1),this.eyeview.width/2,.75*this.eyeview.height),this.hudTexture.needsUpdate=!0},QuizgameVive.prototype.handleViveTrigger1=function(){this.handleViveTrigger(this.controller1)},QuizgameVive.prototype.handleViveTrigger2=function(){this.handleViveTrigger(this.controller2)},QuizgameVive.prototype.handleViveTrigger=function(a){var b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3;a.matrixWorld.decompose(b,c,d);var e=(new THREE.Euler).setFromQuaternion(c,(new THREE.Object3D).eulerOrder);this.shootLaser(b,e)}});